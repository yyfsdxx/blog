# Java Spring MVC 拦截器知识笔记汇总

> 整理时间：2025-08-06

---

## 📌 拦截器注册配置类的作用

你提到的这个方法：

```java
@Override
protected void addInterceptors(InterceptorRegistry registry) {
    log.info("开始注册自定义拦截器...");
    registry.addInterceptor(jwtTokenAdminInterceptor)
            .addPathPatterns("/admin/**")
            .excludePathPatterns("/admin/employee/login");
}
```

### ✅ 是干什么的？
这是 **在 Spring MVC 配置类中注册一个拦截器实例，并指定拦截路径**。不是创建拦截器本身，也不是实现 `HandlerInterceptor` 的方法。

---

## ✅ 拦截器使用的完整流程

1. **编写拦截器类**（实现 `HandlerInterceptor`）：

```java
@Component
public class JwtTokenAdminInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(...) {
        // 登录校验逻辑
        return true;
    }
}
```

2. **注册拦截器到 Spring MVC 中**：

```java
@Configuration
public class WebMvcConfiguration implements WebMvcConfigurer {
    @Autowired
    private JwtTokenAdminInterceptor jwtTokenAdminInterceptor;

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(jwtTokenAdminInterceptor)
                .addPathPatterns("/admin/**")
                .excludePathPatterns("/admin/employee/login");
    }
}
```

---

## ⚙️ WebMvcConfigurer 与 WebMvcConfigurationSupport 区别

| 项目 | WebMvcConfigurer | WebMvcConfigurationSupport |
|------|------------------|-----------------------------|
| 是否禁用 Spring Boot 默认配置 | 否 | 是 |
| 适合场景 | 扩展默认行为（推荐） | 完全自定义 MVC（谨慎） |
| 静态资源是否自动配置 | 是 | 否（需手动配置） |

**结论：** 想保留 Spring Boot 自动配置，只做功能扩展，推荐使用 `WebMvcConfigurer`。

---

## 🧠 HandlerInterceptor 的执行时机说明

| 方法 | 时机 | 用途 |
|------|------|------|
| `preHandle()` | Controller 之前 | 拦截请求、鉴权、记录开始时间 |
| `postHandle()` | Controller 之后，视图渲染前 | 修改模型数据、记录日志 |
| `afterCompletion()` | 整个请求完成后 | 异常处理、资源清理 |

> 拦截器按顺序调用 `preHandle()`，按逆序调用 `postHandle()` 和 `afterCompletion()`。

---

## 🔄 DispatcherServlet 调用流程（简图）

```
Filter.doFilter()（外层拦截）
    ↓
DispatcherServlet
    ↓
HandlerInterceptor.preHandle()
    ↓
Controller 方法
    ↓
HandlerInterceptor.postHandle()
    ↓
视图渲染
    ↓
HandlerInterceptor.afterCompletion()
```

---

## 🧾 总结

- 创建拦截器类时，实现 `HandlerInterceptor` 接口
- 注册拦截器到 Spring MVC，需要在配置类中使用 `addInterceptors(...)`
- 推荐使用 `WebMvcConfigurer` 保留 Spring Boot 的默认行为
- `DispatcherServlet` 管理拦截器的生命周期与执行顺序
