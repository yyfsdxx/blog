# Java Spring MVC æ‹¦æˆªå™¨çŸ¥è¯†ç¬”è®°æ±‡æ€»

> æ•´ç†æ—¶é—´ï¼š2025-08-06

---

## ğŸ“Œ æ‹¦æˆªå™¨æ³¨å†Œé…ç½®ç±»çš„ä½œç”¨

ä½ æåˆ°çš„è¿™ä¸ªæ–¹æ³•ï¼š

```java
@Override
protected void addInterceptors(InterceptorRegistry registry) {
    log.info("å¼€å§‹æ³¨å†Œè‡ªå®šä¹‰æ‹¦æˆªå™¨...");
    registry.addInterceptor(jwtTokenAdminInterceptor)
            .addPathPatterns("/admin/**")
            .excludePathPatterns("/admin/employee/login");
}
```

### âœ… æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ
è¿™æ˜¯ **åœ¨ Spring MVC é…ç½®ç±»ä¸­æ³¨å†Œä¸€ä¸ªæ‹¦æˆªå™¨å®ä¾‹ï¼Œå¹¶æŒ‡å®šæ‹¦æˆªè·¯å¾„**ã€‚ä¸æ˜¯åˆ›å»ºæ‹¦æˆªå™¨æœ¬èº«ï¼Œä¹Ÿä¸æ˜¯å®ç° `HandlerInterceptor` çš„æ–¹æ³•ã€‚

---

## âœ… æ‹¦æˆªå™¨ä½¿ç”¨çš„å®Œæ•´æµç¨‹

1. **ç¼–å†™æ‹¦æˆªå™¨ç±»**ï¼ˆå®ç° `HandlerInterceptor`ï¼‰ï¼š

```java
@Component
public class JwtTokenAdminInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(...) {
        // ç™»å½•æ ¡éªŒé€»è¾‘
        return true;
    }
}
```

2. **æ³¨å†Œæ‹¦æˆªå™¨åˆ° Spring MVC ä¸­**ï¼š

```java
@Configuration
public class WebMvcConfiguration implements WebMvcConfigurer {
    @Autowired
    private JwtTokenAdminInterceptor jwtTokenAdminInterceptor;

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(jwtTokenAdminInterceptor)
                .addPathPatterns("/admin/**")
                .excludePathPatterns("/admin/employee/login");
    }
}
```

---

## âš™ï¸ WebMvcConfigurer ä¸ WebMvcConfigurationSupport åŒºåˆ«

| é¡¹ç›® | WebMvcConfigurer | WebMvcConfigurationSupport |
|------|------------------|-----------------------------|
| æ˜¯å¦ç¦ç”¨ Spring Boot é»˜è®¤é…ç½® | å¦ | æ˜¯ |
| é€‚åˆåœºæ™¯ | æ‰©å±•é»˜è®¤è¡Œä¸ºï¼ˆæ¨èï¼‰ | å®Œå…¨è‡ªå®šä¹‰ MVCï¼ˆè°¨æ…ï¼‰ |
| é™æ€èµ„æºæ˜¯å¦è‡ªåŠ¨é…ç½® | æ˜¯ | å¦ï¼ˆéœ€æ‰‹åŠ¨é…ç½®ï¼‰ |

**ç»“è®ºï¼š** æƒ³ä¿ç•™ Spring Boot è‡ªåŠ¨é…ç½®ï¼ŒåªåšåŠŸèƒ½æ‰©å±•ï¼Œæ¨èä½¿ç”¨ `WebMvcConfigurer`ã€‚

---

## ğŸ§  HandlerInterceptor çš„æ‰§è¡Œæ—¶æœºè¯´æ˜

| æ–¹æ³• | æ—¶æœº | ç”¨é€” |
|------|------|------|
| `preHandle()` | Controller ä¹‹å‰ | æ‹¦æˆªè¯·æ±‚ã€é‰´æƒã€è®°å½•å¼€å§‹æ—¶é—´ |
| `postHandle()` | Controller ä¹‹åï¼Œè§†å›¾æ¸²æŸ“å‰ | ä¿®æ”¹æ¨¡å‹æ•°æ®ã€è®°å½•æ—¥å¿— |
| `afterCompletion()` | æ•´ä¸ªè¯·æ±‚å®Œæˆå | å¼‚å¸¸å¤„ç†ã€èµ„æºæ¸…ç† |

> æ‹¦æˆªå™¨æŒ‰é¡ºåºè°ƒç”¨ `preHandle()`ï¼ŒæŒ‰é€†åºè°ƒç”¨ `postHandle()` å’Œ `afterCompletion()`ã€‚

---

## ğŸ”„ DispatcherServlet è°ƒç”¨æµç¨‹ï¼ˆç®€å›¾ï¼‰

```
Filter.doFilter()ï¼ˆå¤–å±‚æ‹¦æˆªï¼‰
    â†“
DispatcherServlet
    â†“
HandlerInterceptor.preHandle()
    â†“
Controller æ–¹æ³•
    â†“
HandlerInterceptor.postHandle()
    â†“
è§†å›¾æ¸²æŸ“
    â†“
HandlerInterceptor.afterCompletion()
```

---

## ğŸ§¾ æ€»ç»“

- åˆ›å»ºæ‹¦æˆªå™¨ç±»æ—¶ï¼Œå®ç° `HandlerInterceptor` æ¥å£
- æ³¨å†Œæ‹¦æˆªå™¨åˆ° Spring MVCï¼Œéœ€è¦åœ¨é…ç½®ç±»ä¸­ä½¿ç”¨ `addInterceptors(...)`
- æ¨èä½¿ç”¨ `WebMvcConfigurer` ä¿ç•™ Spring Boot çš„é»˜è®¤è¡Œä¸º
- `DispatcherServlet` ç®¡ç†æ‹¦æˆªå™¨çš„ç”Ÿå‘½å‘¨æœŸä¸æ‰§è¡Œé¡ºåº
